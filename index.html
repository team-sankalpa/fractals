<!doctype html>
<html>
  <body>
    <canvas id="myCanvas" width="800" height="800"></canvas>
    <button onclick="zoom(10)">+</button>
    <button onclick="zoom(-10)">-</button>
    <script>
    	let canvas = document.getElementById('myCanvas')
    	let ctx = canvas.getContext('2d')
    	
    	let scaleFactor = 200
    	let panX = 2
    	let panY = 1.5
        let requestId

    	function paint(canvas, ctx, scaleFactor, panX, panY){
 		    for(let x = 0; x < canvas.width; x++){
		    	for(let y = 0; y < canvas.height; y++){
		    	
			    	let color = checkIfBelongsToMandelbrotSet(x/scaleFactor - panX, 
			                                      y/scaleFactor - panY)
			                                      
					ctx.fillStyle = color === 0 ? '#000' : `hsl(0, 100%, ${color}%)`
					ctx.fillRect(x,y, 1,1)
		       }
		    }
        }
        function checkIfBelongsToMandelbrotSet(x, y){
        	let oX = x, oY = y
			let maxIterations = 100
      		for(let i=0; i < maxIterations; i++){
      			let tempX = x * x - y * y - oX
      			let tempY = 2 * x * y - oY
      			x = tempX
      			y = tempY
      			if (x * y > 4)
      				return (i * 255 /maxIterations) 
      		}
      		return 0
        }
        let paintFrame = () =>{
        	if(requestId){
        		console.log("clearing earlier paint request")
        		cancelAnimationFrame(requestId)
        	}
	    	requestId = requestAnimationFrame(() => {
	    		paint(canvas, ctx, scaleFactor, panX, panY)
	    	})
        }
        let timeout
        let zoom = factor => {
        	scaleFactor += factor
        	if(timeout){
        		clearTimeout(timeout)
        	}
        	timeout = setTimeout(paintFrame, 350)
        }        
    	paintFrame()
    </script>
  </body>
</html>


